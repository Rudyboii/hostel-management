<!DOCTYPE html>
<html>
<head>
  <title>Login | Smart Hostel System</title>
</head>

<body style="
  margin:0;
  font-family:Arial, Helvetica, sans-serif;
  background:linear-gradient(to right, #e3f2fd, #ffffff);
">

<!-- HEADER -->
<div style="
  background:#1e88e5;
  color:white;
  padding:15px 40px;
  display:flex;
  justify-content:space-between;
  align-items:center;
">
  <h2 style="margin:0;">Smart Hostel Management System</h2>

  <!-- HOME BUTTON -->
  <a href="../index.html" style="
    background:white;
    color:#1e88e5;
    padding:6px 12px;
    border-radius:4px;
    text-decoration:none;
    font-size:14px;
  ">
    Home
  </a>
</div>


<!-- LOGIN BOX -->
<div style="
  display:flex;
  justify-content:center;
  align-items:center;
  height:85vh;
">

  <div style="
    background:white;
    padding:30px;
    width:350px;
    border-radius:6px;
    box-shadow:0 4px 10px rgba(0,0,0,0.1);
  ">

    <h2 style="text-align:center; color:#0d47a1;">Login</h2>

    <input id="email" type="email" placeholder="Email"
      style="width:100%; padding:10px; margin:10px 0;">

    <input id="password" type="password" placeholder="Password"
      style="width:100%; padding:10px; margin:10px 0;">

    <button onclick="loginUser()"
      style="
        width:100%;
        padding:10px;
        background:#1e88e5;
        color:white;
        border:none;
        font-size:16px;
        cursor:pointer;
      ">
      Login
    </button>


    <p style="text-align:center; margin-top:15px;">
      New user?
      <a href="register.html" style="color:#1e88e5;">Register here</a>
    </p>

    <button onclick="googleLogin()" style="
  width:100%;
  padding:10px;
  background:#db4437;
  color:white;
  border:none;
  font-size:16px;
  margin-top:10px;
  cursor:pointer;
">
  Sign in with Google
</button>

  </div>
</div>

<!-- FIREBASE CONFIG -->
<script type="module" src="../js/config.js"></script>

<script type="module">
import { signInWithEmailAndPassword } 
from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";
import { doc, getDoc } 
from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

window.loginUser = async function () {
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;

  try {
    const userCred = await signInWithEmailAndPassword(auth, email, password);
    const uid = userCred.user.uid;

    const userDoc = await getDoc(doc(db, "users", uid));
    const role = userDoc.data().role;

    if (role === "admin") {
      window.location.href = "../dashboard/admin.html";
    } else {
      window.location.href = "../dashboard/student.html";
    }
  } catch (error) {
    alert("Invalid login credentials");
  }
};
</script>
<script type="module">
import { 
  signInWithEmailAndPassword,
  GoogleAuthProvider,
  signInWithPopup
} from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";

import { doc, getDoc, setDoc } 
from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

/* EMAIL LOGIN (already present) */
window.loginUser = async function () {
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;

  const userCred = await signInWithEmailAndPassword(auth, email, password);
  redirectUser(userCred.user.uid);
};

/* GOOGLE LOGIN */
window.googleLogin = async function () {
  const provider = new GoogleAuthProvider();
  const result = await signInWithPopup(auth, provider);

  const user = result.user;
  const userRef = doc(db, "users", user.uid);
  const userSnap = await getDoc(userRef);

  // If first time Google user â†’ save as student by default
  if (!userSnap.exists()) {
    await setDoc(userRef, {
      name: user.displayName,
      email: user.email,
      role: "student"
    });
  }

  redirectUser(user.uid);
};

/* ROLE REDIRECT */
async function redirectUser(uid) {
  const userDoc = await getDoc(doc(db, "users", uid));
  const role = userDoc.data().role;

  if (role === "admin") {
    window.location.href = "../dashboard/admin.html";
  } else {
    window.location.href = "../dashboard/student.html";
  }
}
</script>


</body>
</html>
