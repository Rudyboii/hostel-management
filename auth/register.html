<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Register | Smart Hostel</title>
</head>

<body style="
  margin:0;
  font-family:'Segoe UI', Arial, sans-serif;
  background:linear-gradient(135deg,#1976d2,#42a5f5);
  height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
">

<div style="
  background:white;
  padding:40px;
  width:380px;
  border-radius:22px;
  text-align:center;
  box-shadow:0 25px 60px rgba(0,0,0,0.25);
">

  <h2>Create Account ðŸ‘‹</h2>
  <p style="color:#555;">
    Register to use hostel services
  </p>

  <!-- REGISTER BUTTON -->
  <button
    id="googleRegister"
    style="
      margin-top:30px;
      width:100%;
      padding:14px;
      background:#0d47a1;
      color:white;
      border:none;
      border-radius:12px;
      font-size:15px;
      cursor:pointer;
    "
  >
    Register with Google
  </button>

  <p style="margin-top:25px;font-size:14px;">
    Already registered?
    <a href="login.html" style="color:#0d47a1;text-decoration:none;">
      Login here
    </a>
  </p>

</div>

<script type="module">
import { auth, db } from "../src/config.js";
import {
  GoogleAuthProvider,
  signInWithPopup
} from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";
import {
  doc,
  getDoc,
  setDoc
} from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

const provider = new GoogleAuthProvider();

document.getElementById("googleRegister").onclick = async () => {
  try {
    const result = await signInWithPopup(auth, provider);
    const user = result.user;

    const userRef = doc(db, "users", user.uid);
    const snap = await getDoc(userRef);

    if (snap.exists()) {
      alert("You are already registered. Redirecting to login.");
      window.location.href = "login.html";
      return;
    }

    // Create new student
    await setDoc(userRef, {
      name: user.displayName,
      email: user.email,
      role: "student",
      createdAt: new Date()
    });

    alert("Registration successful!");
    window.location.href = "../dashboard/student.html";

  } catch (error) {
    alert(error.message);
  }
};
</script>

</body>
</html>
