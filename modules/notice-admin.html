<!DOCTYPE html>
<html>
<head>
  <title>Notice Admin</title>
</head>

<body style="margin:0;font-family:Segoe UI,Arial;background:#eef3f9;">

<!-- HEADER -->
<div style="background:#0d47a1;color:white;padding:16px 30px;display:flex;justify-content:space-between;">
  <h3 style="margin:0;">Notice Management</h3>
  <a href="javascript:history.back()" style="color:white;text-decoration:none;">‚Üê Back</a>
</div>

<!-- FORM -->
<div style="max-width:900px;margin:40px auto;padding:0 20px;">
  <div style="background:white;padding:30px;border-radius:16px;box-shadow:0 10px 25px rgba(0,0,0,.1);">

    <h2>Create Notice</h2>

    <label><b>Title</b></label>
    <input id="title" type="text" required
      placeholder="Enter notice title"
      style="width:100%;padding:12px;margin:10px 0 20px;">

    <label><b>Message</b></label>
    <textarea id="message" required
      placeholder="Enter notice details"
      style="width:100%;height:120px;padding:12px;margin:10px 0 30px;"></textarea>

    <button id="publishBtn"
      style="background:#0d47a1;color:white;padding:14px 30px;border:none;border-radius:8px;cursor:pointer;">
      Publish Notice
    </button>

  </div>
</div>
<!-- PUBLISHED NOTICES -->
<div style="
  background:white;
  padding:30px;
  border-radius:16px;
  box-shadow:0 10px 25px rgba(0,0,0,.1);
  margin-top:40px;
">

  <h2>Published Notices</h2>

  <div id="adminNoticeList">
    Loading notices...
  </div>

</div>


<!-- FIREBASE -->
<script type="module">
import { db } from "../src/config.js";
import {
  collection,
  addDoc,
  getDocs,
  query,
  orderBy,
  Timestamp
} from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

const titleInput = document.getElementById("title");
const messageInput = document.getElementById("message");
const publishBtn = document.getElementById("publishBtn");
const noticeList = document.getElementById("adminNoticeList");

// ================= PUBLISH NOTICE =================
publishBtn.onclick = async () => {
  const title = titleInput.value.trim();
  const message = messageInput.value.trim();

  if (!title || !message) {
    alert("All fields are required");
    return;
  }

  await addDoc(collection(db, "notices"), {
    title,
    message,
    createdAt: Timestamp.now()
  });

  titleInput.value = "";
  messageInput.value = "";

  loadNotices(); // refresh list
};

// ================= LOAD NOTICES =================
async function loadNotices() {
  noticeList.innerHTML = "";

  const q = query(
    collection(db, "notices"),
    orderBy("createdAt", "desc")
  );

  const snapshot = await getDocs(q);

  if (snapshot.empty) {
    noticeList.innerHTML = "<p>No notices published yet.</p>";
    return;
  }

  snapshot.forEach(doc => {
    const n = doc.data();

    const card = document.createElement("div");
    card.style = `
      padding:18px 0;
      border-bottom:1px solid #eee;
    `;

    card.innerHTML = `
      <h4 style="margin:0;">${n.title}</h4>
      <p style="margin:8px 0;color:#555;">${n.message}</p>
      <small style="color:#888;">Posted recently</small>
    `;

    noticeList.appendChild(card);
  });
}

// Load notices on page load
loadNotices();
</script>

</body>
</html>
