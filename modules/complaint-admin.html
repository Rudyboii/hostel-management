<!DOCTYPE html>
<html>
<head>
  <title>Complaint Management</title>
</head>

<body style="margin:0;font-family:Segoe UI,Arial;background:#eef3f9;">

<!-- HEADER -->
<div style="background:#0d47a1;color:white;padding:16px 30px;display:flex;justify-content:space-between;">
  <h3 style="margin:0;">Complaint Management</h3>
  <a href="javascript:history.back()" style="color:white;text-decoration:none;">‚Üê Back</a>
</div>

<!-- LIST -->
<div style="max-width:1000px;margin:40px auto;padding:0 20px;" id="list">
  Loading complaints...
</div>

<!-- FIREBASE LOGIC -->
<script type="module">
import { db } from "../src/config.js";
import {
  collection,
  getDocs,
  doc,
  updateDoc
} from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

const list = document.getElementById("list");
list.innerHTML = "";

const snapshot = await getDocs(collection(db, "complaints"));

snapshot.forEach(d => {
  const c = d.data();

  const card = document.createElement("div");
  card.style = `
    background:white;
    padding:25px;
    border-radius:16px;
    margin-bottom:20px;
    box-shadow:0 10px 25px rgba(0,0,0,.1);
  `;

  card.innerHTML = `
    <h3>${c.type}</h3>
    <p><b>Room:</b> ${c.room}</p>
    <p><b>Student:</b> ${c.studentEmail}</p>
    <p style="color:#555;">${c.description}</p>
    <p><b>Status:</b> ${c.status}</p>
    ${c.status === "pending" ? `<button style="background:#0d47a1;color:white;border:none;padding:10px 20px;border-radius:8px;cursor:pointer;">
      Mark as Resolved
    </button>` : ""}
  `;

  if (c.status === "pending") {
    card.querySelector("button").onclick = async () => {
      await updateDoc(doc(db, "complaints", d.id), {
        status: "resolved"
      });
      location.reload();
    };
  }

  list.appendChild(card);
});
</script>

</body>
</html>
